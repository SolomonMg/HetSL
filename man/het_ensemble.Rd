% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/het_ensemble.R
\name{het_ensemble}
\alias{het_ensemble}
\title{Fit Heterogeneous Treatment Effects Ensemble}
\usage{
het_ensemble(
  formula = NULL,
  data,
  outcome = NULL,
  treatment = NULL,
  covariates = NULL,
  learners = NULL,
  nfolds = 10L,
  family = NULL,
  weights = NULL,
  propensity = NULL,
  parallel = FALSE,
  on_error = c("warn", "stop", "ignore"),
  seed = NULL,
  verbose = TRUE
)
}
\arguments{
\item{formula}{Formula specifying the model. Can use pipe syntax:
\code{outcome ~ covariates | treatment} where covariates and treatment
are separated by \code{|}. Alternatively, specify outcome, treatment,
and covariates explicitly.}

\item{data}{A data frame containing the variables in the model.}

\item{outcome}{Character. Name of the outcome variable (alternative to formula).}

\item{treatment}{Character. Name of the treatment variable (alternative to formula).}

\item{covariates}{Character vector. Names of covariate variables (alternative to formula).}

\item{learners}{Character vector of learner names to use, or NULL to auto-detect
available learners based on installed packages. See \code{\link{available_learners}}.}

\item{nfolds}{Integer. Number of cross-validation folds (default 10).}

\item{family}{Character. Either "binomial" for binary outcomes or "gaussian"
for continuous outcomes. If NULL, auto-detected from outcome.}

\item{weights}{Numeric vector of observation weights (e.g., sampling weights).}

\item{propensity}{Either a character string naming a propensity score column
in data, or a formula for propensity score estimation. Used for
observational studies.}

\item{parallel}{Logical. Use parallel processing via future/furrr.}

\item{on_error}{Character. How to handle learner failures: "warn" (default),
"stop", or "ignore".}

\item{seed}{Integer. Random seed for reproducibility.}

\item{verbose}{Logical. Print progress messages.}
}
\value{
An object of class \code{het_ensemble} with components:
\describe{
\item{weights}{Named vector of ensemble weights}
\item{models}{List of fitted model objects}
\item{cv_predictions}{Matrix of cross-validation predictions}
\item{cv_performance}{Data frame of CV performance metrics}
\item{call}{The matched call}
\item{data}{List with y, X, treatment vectors}
\item{formula}{Formula used (if any)}
\item{family}{Outcome family}
\item{learner_names}{Names of learners used}
}
}
\description{
Main function for fitting ensemble models for heterogeneous treatment effects.

Fits an ensemble of machine learning models to estimate heterogeneous
treatment effects, following Grimmer, Messing & Westwood (2017).
}
\examples{
\dontrun{
# Using formula interface with pipe syntax
fit <- het_ensemble(
  outcome ~ age + female + education | treatment,
  data = mydata,
  nfolds = 10
)

# Using explicit arguments
fit <- het_ensemble(
  data = mydata,
  outcome = "y",
  treatment = "treat",
  covariates = c("age", "female", "education")
)

# With specific learners
fit <- het_ensemble(
  outcome ~ x1 + x2 | treat,
  data = mydata,
  learners = c("lasso", "randomforest", "causal_forest")
)

# Observational study with propensity weighting
fit <- het_ensemble(
  outcome ~ x1 + x2 | treat,
  data = mydata,
  propensity = "ps_column"  # Pre-estimated propensity scores
)
}
}
